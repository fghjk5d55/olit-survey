<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OLIT Vape Survey & Lucky Draw</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- æ·»åŠ  EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        /* ä¿æŒåŸæœ‰CSSä¸å˜ */
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #ff6b6b;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7ff;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        /* å…¶ä½™CSSä¿æŒä¸å˜... */
    </style>
</head>
<body>
    <!-- ä¿æŒåŸæœ‰HTMLç»“æ„ä¸å˜ -->
    <div class="container">
        <header>
            <img src="https://via.placeholder.com/150x50?text=OLIT+Logo" alt="OLIT Logo" class="logo">
            <h1>OLIT Vape Survey & Lucky Draw</h1>
            <p class="subtitle">Share your feedback and get a chance to win exciting prizes!</p>
        </header>
        
        <div id="formSection">
            <form id="surveyForm" class="form-container">
                <!-- ä¿æŒåŸæœ‰è¡¨å•å­—æ®µä¸å˜... -->
            </form>
        </div>
        
        <div id="resultSection" class="result-container">
            <!-- ç»“æœå±•ç¤ºåŒºåŸŸä¿æŒä¸å˜... -->
        </div>
        
        <div id="closedSection" class="closed-message">
            <!-- å…³é—­æç¤ºä¿æŒä¸å˜... -->
        </div>
        
        <footer>
            <p>Â© 2025 OLIT Vapes. All rights reserved.</p>
            <p>Survey closes at 11:59 PM EST on July 31, 2025</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ–EmailJSï¼ˆä½¿ç”¨æ‚¨æä¾›çš„Public Keyï¼‰
        emailjs.init('mj_XzcWECPBPp-vZC');

        // é…ç½®å‚æ•°
        const MAX_PARTICIPANTS = 100;
        const WINNERS_COUNT = 3;
        const END_DATE = new Date('July 31, 2025 23:59:00 EST');
        
        // è·Ÿè¸ªå‚ä¸è€…å’Œè·å¥–è€…
        let participants = JSON.parse(localStorage.getItem('olit_participants')) || [];
        let winners = JSON.parse(localStorage.getItem('olit_winners')) || [];
        
        // è·å–DOMå…ƒç´ 
        const form = document.getElementById('surveyForm');
        const formSection = document.getElementById('formSection');
        const resultSection = document.getElementById('resultSection');
        const resultContent = document.getElementById('resultContent');
        const closedSection = document.getElementById('closedSection');
        const participantCounts = document.querySelectorAll('.counter span');
        const loadingIndicator = document.getElementById('loadingIndicator');
        
        // æ£€æŸ¥æ´»åŠ¨çŠ¶æ€
        function checkCampaignStatus() {
            const now = new Date();
            const isClosed = now > END_DATE || participants.length >= MAX_PARTICIPANTS;
            
            if (isClosed) {
                formSection.style.display = 'none';
                resultSection.style.display = 'none';
                closedSection.style.display = 'block';
                return true;
            }
            return false;
        }
        
        // æ›´æ–°å‚ä¸è€…è®¡æ•°
        function updateParticipantCount() {
            participantCounts.forEach(el => {
                el.textContent = participants.length;
            });
        }
        
        // åˆ›å»ºåº†ç¥æ•ˆæœ
        function createConfetti() {
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 2 + 2 + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦ä¸­å¥–
        function checkWinner(userId) {
            if (winners.length < WINNERS_COUNT) {
                const chance = WINNERS_COUNT / Math.max(MAX_PARTICIPANTS - participants.length + 1, WINNERS_COUNT);
                if (Math.random() < chance) {
                    winners.push(userId);
                    localStorage.setItem('olit_winners', JSON.stringify(winners));
                    return true;
                }
            }
            return winners.includes(userId);
        }
        
        // ä½¿ç”¨EmailJSå‘é€é‚®ä»¶
        async function sendEmail(formData) {
            try {
                const response = await emailjs.send(
                    'service_mtjey4p',       // æ‚¨çš„Service ID
                    'template_ieuts95',      // æ‚¨çš„Template ID
                    {
                        name: formData.get('name'),
                        country: formData.get('country'),
                        phone: formData.get('phone'),
                        products: formData.get('products'),
                        flavors: formData.get('flavors'),
                        reply_to: 'optimum1346@gmail.com'  // æ¥æ”¶å›å¤çš„é‚®ç®±
                    }
                );
                return response.status === 200;
            } catch (error) {
                console.error('é‚®ä»¶å‘é€å¤±è´¥:', error);
                return false;
            }
        }
        
        // è¡¨å•æäº¤å¤„ç†
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (checkCampaignStatus()) return;
            
            // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
            loadingIndicator.style.display = 'block';
            form.querySelector('.submit-btn').disabled = true;
            
            // åˆ›å»ºç”¨æˆ·å¯¹è±¡
            const formData = new FormData(form);
            const user = {
                id: Date.now().toString(),
                name: formData.get('name'),
                country: formData.get('country'),
                phone: formData.get('phone'),
                products: formData.get('products'),
                flavors: formData.get('flavors'),
                timestamp: new Date().toISOString()
            };
            
            // å°è¯•å‘é€é‚®ä»¶
            const emailSent = await sendEmail(formData);
            
            if (!emailSent) {
                alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–è”ç³»å®¢æœã€‚');
                loadingIndicator.style.display = 'none';
                form.querySelector('.submit-btn').disabled = false;
                return;
            }
            
            // æ·»åŠ åˆ°å‚ä¸è€…åˆ—è¡¨
            participants.push(user.id);
            localStorage.setItem('olit_participants', JSON.stringify(participants));
            updateParticipantCount();
            
            // æ£€æŸ¥æ˜¯å¦ä¸­å¥–
            const isWinner = checkWinner(user.id);
            
            // æ˜¾ç¤ºç»“æœ
            loadingIndicator.style.display = 'none';
            formSection.style.display = 'none';
            resultSection.style.display = 'block';
            
            if (isWinner) {
                resultContent.innerHTML = `
                    <div class="result-icon winner">ğŸ‰</div>
                    <h2 class="winner">æ­å–œæ‚¨ä¸­å¥–äº†ï¼</h2>
                    <p>æ‚¨æ˜¯æˆ‘ä»¬çš„å¹¸è¿è·å¥–è€…ä¹‹ä¸€ï¼</p>
                    <p>å®¢æœå°†åœ¨3ä¸ªå·¥ä½œæ—¥å†…è”ç³»æ‚¨å‘æ”¾å¥–å“ã€‚</p>
                `;
                createConfetti();
            } else {
                resultContent.innerHTML = `
                    <div class="result-icon not-winner">ğŸ‘</div>
                    <h2 class="not-winner">æ„Ÿè°¢å‚ä¸ï¼</h2>
                    <p>æˆ‘ä»¬å·²æ”¶åˆ°æ‚¨çš„åé¦ˆã€‚</p>
                    <p>è™½ç„¶æœ¬æ¬¡æœªä¸­å¥–ï¼Œè¯·ç»§ç»­å…³æ³¨æˆ‘ä»¬åç»­æ´»åŠ¨ï¼</p>
                `;
            }
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°äººæ•°ä¸Šé™
            if (participants.length >= MAX_PARTICIPANTS) {
                setTimeout(() => {
                    closedSection.style.display = 'block';
                    resultSection.style.display = 'none';
                }, 5000);
            }
        });
        
        // åˆå§‹åŒ–
        updateParticipantCount();
        checkCampaignStatus();
    </script>
</body>
</html>